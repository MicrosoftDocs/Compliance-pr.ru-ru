---
title: Устойчивость данных Exchange Online в Microsoft 365
description: В этой статье вы найдете описание различных аспектов устойчивости данных в Exchange Online и Microsoft 365.
ms.author: robmazz
author: robmazz
manager: laurawi
ms.reviewer: sosstah
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection:
- Strat_O365_IP
- M365-security-compliance
- MS-Compliance
f1.keywords:
- NOCSH
ms.custom: seo-marvel-apr2020
titleSuffix: Microsoft Service Assurance
ms.openlocfilehash: 2cdd37d34612421cc7a9e4687134e2a1e2b1aeec
ms.sourcegitcommit: b06fa9f1b230fd5e470817486ea51f460f28b691
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/27/2021
ms.locfileid: "50012945"
---
# <a name="exchange-online-data-resiliency-in-microsoft-365"></a>Устойчивость данных Exchange Online в Microsoft 365

>[!IMPORTANT]
>Так как мы продолжаем вкладывать средства в различные способы сохранения содержимого почтовых ящиков, мы объявляем о завершении In-Place в Центре администрирования Exchange (EAC) в Exchange Online. С 1 июля 2020 г. вы не сможете создавать новые In-Place. Но вы по-прежнему сможете управлять In-Place в EAC или с помощью cmdlet **Set-MailboxSearch** в Exchange Online PowerShell. Однако с 1 октября 2020 г. вы не сможете управлять In-Place. Удалить их можно только в EAC или с помощью cmdlet **Remove-MailboxSearch.** Использование In-Place в Exchange Server и гибридных развертываниях Exchange по-прежнему будет поддерживаться. Дополнительные сведения о завершении In-Place в Exchange Online см. в подмене устаревших средств [eDiscovery.](https://docs.microsoft.com/microsoft-365/compliance/legacy-ediscovery-retirement)

Запрет на удаление позволяет сохранить все содержимое почтового ящика, в том числе удаленные элементы и исходные версии измененных элементов. Все такие элементы почтового ящика возвращаются при поиске [Обнаружение электронных данных на месте](https://docs.microsoft.com/exchange/security-and-compliance/in-place-ediscovery/in-place-ediscovery). При размещении In-Place почтового ящика пользователя содержимое соответствующего архивного почтового ящика (если оно включено) также помещается на удержание и возвращается при поиске при обнаружении электронных данных.

Существует два типа повреждения, которые могут повлиять на базу данных Exchange: физическое повреждения, которое обычно вызвано проблемами с оборудованием (в частности, оборудованием хранилища) и логическим повреждениям, которые возникают из-за других факторов. Как правило, существует два типа логического повреждения, которые могут произойти в базе данных Exchange:

- **Логическое повреждения базы** данных : контрольная контрольнаямбла страницы базы данных соответствует, но данные на странице неправы логически. Это может произойти, когда обсистема базы данных (ESE) пытается записать страницу базы данных, и даже если операционная система возвращает сообщение об успешном результате, данные либо никогда не записываюются на диск, либо записываюются в неправильное место. Такая ситуация называется *утерянной очисткой*. ESE включает множество функций и мер безопасности, предназначенных для предотвращения физического повреждения базы данных и других сценариев потери данных. Чтобы предотвратить потерю данных потерянными очистками, ESE включает механизм обнаружения потерянных очистки в базу данных вместе с функцией (восстановление одной страницы) для ее исправления.
- **Логическое повреждения в** хранилище— данные добавляются, удаляются или управляются так, как пользователь не ожидает. Эти случаи вызваны приложениями сторонних приложений. Как правило, это повреждения в том смысле, что пользователь рассматривает его как повреждения. Хранилище Exchange считает транзакцию, которая привела к логическому повреждению серией правильных операций MAPI. Функции [хранения на](https://docs.microsoft.com/exchange/security-and-compliance/create-or-remove-in-place-holds) месте в Exchange Online обеспечивают защиту от логического повреждения содержимого (так как это предотвращает окончательное удаление контента пользователем или приложением). 

Exchange Online выполняет несколько проверок согласованности реплицируемых файлов журнала во время проверки журнала и воспроизведения журнала. Эти проверки согласованности предотвращают репликацию физического повреждения системой. Например, во время проверки журнала проводится проверка физической целостности, которая проверяет файл журнала и проверяет, соответствует ли контрольная контрольнаяума, записанная в файле журнала, контрольной памяти, сгенерированной в памяти. Кроме того, заглавная запись файла журнала проверяется, чтобы убедиться, что подпись файла журнала, записанная в загоне журнала, совпадает с подписью файла журнала. Во время воспроизведения журнала файл журнала подвергается дополнительной проверке. Например, заглавная запись базы данных также содержит подпись журнала, сравниваемую с сигнатурой файла журнала, чтобы убедиться, что они совпадают. 

Защита от повреждения данных почтовых ящиков в Exchange Online достигается с помощью Средства защиты данных Exchange Native Data Protection, которая использует репликацию на уровне приложений на нескольких серверах и в нескольких центрах обработки данных, а также другие функции, которые помогают защитить данные от потери из-за повреждения или по другим причинам. К этим функциям относятся функции, управляемые Корпорацией Майкрософт или самим приложением Exchange Online, например:

- [Группы доступности данных](https://docs.microsoft.com/exchange/back-up-email)
- Одно битовая коррекция 
- Сканирование базы данных по сети 
- Обнаружение потерянных очистки 
- Восстановление одной страницы 
- Служба репликации почтовых ящиков 
- Проверка файлов журнала 
- Развертывание в отказоустойчивых файловых системах 

Для получения дополнительных сведений о перечисленных ранее нативных функций выберите гиперссылки и дополнительные сведения об элементе без гиперссылки см. в следующих сведениях. Помимо этих основных функций, Exchange Online также включает функции устойчивости данных, которые клиенты могут управлять, например: 
- [Восстановление одного элемента (включено по умолчанию)](https://docs.microsoft.com/exchange/recipients-in-exchange-online/manage-user-mailboxes/recover-deleted-messages) 
- [Хранение на месте и хранение для судебного разбирательства](https://docs.microsoft.com/exchange/security-and-compliance/in-place-and-litigation-holds) 
- [Хранение удаленных элементов и Soft-Deleted почтовых ящиков (оба включены по умолчанию)](https://docs.microsoft.com/exchange/recipients-in-exchange-online/delete-or-restore-mailboxes) 

## <a name="database-availability-groups"></a>Группы доступности баз данных 
Каждая база данных почтовых ящиков в Microsoft 365 находится в группе обеспечения доступности баз данных [(DAG)](https://docs.microsoft.com/exchange/back-up-email) и реплицируется в географически отдельные центры обработки данных в одном регионе. Самая распространенная конфигурация — четыре копии базы данных в четырех центрах обработки данных; однако в некоторых регионах меньше центра обработки данных (базы данных реплицированы в три центра обработки данных в Индии и два центра обработки данных в Австралии и Японии). Но во всех случаях каждая база данных почтовых ящиков имеет четыре копии, распределенные между несколькими центрами обработки данных, что обеспечивает защиту данных почтовых ящиков от сбоев программного обеспечения, оборудования и даже центра обработки данных. 

Из этих четырех копий три из них настроены как высокодоступные. Четвертая копия настроена как отстает копия [базы данных.](https://docs.microsoft.com/Exchange/high-availability/manage-ha/activate-lagged-db-copies) Отстает копия базы данных не предназначена для восстановления отдельных почтовых ящиков или элементов почтовых ящиков. Его цель — предоставить механизм восстановления для редких системных катастрофического логического повреждения. 

Для отстаемых копий базы данных в Exchange Online настроено семидневный период задержки воспроизведения файла журнала. Кроме того, диспетчер задержки воспроизведения Exchange позволяет обеспечить динамическое воспроизведение файлов журнала для отстает копий, чтобы обеспечить самостоятельное восстановление копий базы данных и управление увеличением размеров файлов журналов. Несмотря на то, что в Exchange Online используются копии базы данных с отстает, важно понимать, что они не являются гарантированной резервной копией на момент времени. Для отстающих копий базы данных в Exchange Online пороговое значение доступности обычно составляет около 90 %, из-за периодов, когда диск, содержащий отстающие копии, теряется из-за сбоя диска, из-за чего отстающие копии становятся высокодоступной копией (из-за автоматического воспроизведения), а также периоды, в течение которых резервная копия базы данных перестраиваться в очередь воспроизведения журнала. 

## <a name="transport-resilience"></a>Устойчивость транспорта 
Exchange Online включает две основные функции устойчивости транспорта: теневая избыточность и сеть безопасности. Теневая избыточность сохраняет резервную копию сообщения в пути. Сеть безопасности сохраняет резервную копию сообщения после успешной доставки сообщения. 

При теневой избыточности каждый транспортный сервер Exchange Online создает копию каждого получаемого сообщения, прежде чем он подтверждает успешное получение сообщения на отправляя сервер. Это делает все сообщения в транспортном конвейере избыточными во время транспортировки. Если Exchange Online определяет, что исходное сообщение было потеряно при переходе, резервная копия сообщения будет переназначена. 

Сеть безопасности — это очередь транспорта, связанная со службой транспорта на сервере почтовых ящиков. В этой очереди хранятся копии сообщений, успешно обработанных сервером. Если для сбоя базы данных почтовых ящиков или сервера требуется активировать устарелую копию базы данных почтовых ящиков, сообщения в очереди "Сеть безопасности" автоматически повторно пересылаются в новую активную копию базы данных почтовых ящиков. Сеть безопасности также является избыточной, тем самым исключая транспорт как единую точку сбоя. В ней используется концепция основной и теневой сетей безопасности, в которых, если основная сеть безопасности недоступна более 12 часов, запросы на повторное представление становятся теневыми запросами на повторное представление, а сообщения повторно из теневой сети безопасности повторно.

Повторное отправление сообщений из сети безопасности автоматически инициируется компонентом Active Manager службы репликации Microsoft Exchange, который управляет dags и копиями базы данных почтовых ящиков. Для повторной передачи сообщений из сети безопасности не требуется никаких действий вручную. 

## <a name="single-bit-correction"></a>Одно битовая коррекция 
ESE включает механизм обнаружения и устранения одно битов ошибок CRC (также известных как одно битовая пролистывка), которые являются результатом аппаратных ошибок (и поэтому представляют физическое повреждения). При таких ошибках ESE автоматически исправит их и занося событие в журнал событий. 

## <a name="online-database-scanning"></a>Сканирование базы данных по сети 
Сетевое сканирование баз данных (также известное как суммирования для проверки базы *данных)*— это процесс, в котором ESE использует проверку согласованности базы данных для чтения каждой страницы и проверки повреждения страницы. Основная цель — обнаружить физическое повреждения и потерянные очистки, которые могут не быть обнаружены транзакционными операциями. Сканирование базы данных также выполняет операции после сбоя в хранилище. Из-за сбоя может быть утечка пространства, а сканирование базы данных в Интернете находит и восстанавливает потерянный пробел. Система разработана с учетом того, что каждая база данных проверяется каждые семь дней. 

## <a name="lost-flush-detection"></a>Обнаружение потерянных очистки 
Потеря очистки происходит, когда операция записи базы данных, которую подсистема диска или операционная система вернула как завершенную, фактически не была записана на диск или была написана в неправильном расположении. Потерянные инциденты очистки могут привести к логическому повреждениям базы данных, поэтому во избежание потери очистки в результате потери данных ESE включает механизм обнаружения потерянных очистки. По мере того как страницы базы данных записаны в пассивные копии, выполняется проверка на потерянные очистки активной копии. Если обнаружена потеря очистки, ESE может восстановить процесс с помощью процесса исправления страницы. 

## <a name="single-page-restore"></a>Восстановление одной страницы 
Восстановление одной страницы, также известное как исправление *страниц,*— это автоматический процесс, при котором поврежденные страницы базы данных заменяются на полезные копии из правильной реплики. Процесс восстановления поврежденной страницы зависит от того, является ли копия базы данных активной или пассивной. Когда активная копия базы данных сталкивается с поврежденной страницей, она может скопировать страницу из одной из реплик, если страница, скопированная на нее, находится в состоянии "в курсе". Этот процесс выполняется путем ввода запроса страницы в поток журнала, который является основой репликации базы данных почтовых ящиков. Как только реплика сталкивается с запросом страницы, она отправляет копию страницы запрашиваемой копии базы данных. Восстановление одной страницы также предоставляет механизм асинхронного взаимодействия для активного запроса страницы у реплик, даже если реплики в данный момент находятся в автономном режиме. 

В случае повреждения пассивной копии базы данных, включая отстает копия базы данных, так как эти копии всегда находятся за их активной копией, всегда безопасно копировать любую страницу из активной копии в пассивную копию. Пассивная копия базы данных по своей природе является высокодоступной, поэтому во время процесса исправления страницы воспроизведение журнала приостановлено, но копирование журнала продолжается. Пассивная копия базы данных извлекает копию поврежденной страницы из активной копии, ждет копирования и проверки файла журнала, удовлетворяющего максимальному требованию к генерации журнала, а затем исправления поврежденной страницы. После исправления страницы воспроизведение журнала возобновляется. Процесс для отстаемой копии базы данных один и тот же, за исключением того, что отстаемая база данных сначала повторит все файлы журналов, необходимые для обеспечения исправлений. 

## <a name="mailbox-replication-service"></a>Служба репликации почтовых ящиков 
Перемещение почтовых ящиков является ключевой частью управления крупномасштабной службой электронной почты. Всегда имеются обновленные технологии и обновление оборудования и версий, поэтому наличие надежной системы с регулированием, которая позволяет нашим инженерам выполнять эту работу, сохраняя прозрачное перемещение почтовых ящиков для пользователей (убедившись, что они остаются в сети на протяжении всего процесса) является ключевым фактором и обеспечивает корректное масштабирования по мере того, как почтовые ящики будут масштабироваться. 

Служба репликации почтовых ящиков Exchange (MRS) отвечает за перемещение почтовых ящиков между базами данных. Во время перемещения mrs выполняет проверку согласованности для всех элементов в почтовом ящике. Если обнаружена проблема с единообразием, MRS исправит проблему или пропустит поврежденные элементы, тем самым удалив повреждения из почтового ящика. 

Так как MRS является компонентом Exchange Online, мы можем внести изменения в его код, чтобы решить новые формы повреждения, обнаруженные в будущем. Например, если обнаружена проблема согласованности, которую mrs не может устранить, мы можем проанализировать повреждения, изменить код MRS и устранить несоответствие (если мы понимаем, как это сделать). 

## <a name="log-file-checks"></a>Проверка файлов журнала 
Все файлы журнала транзакций, созданные базой данных Exchange, проходят несколько проверок согласованности. После создания файла журнала сначала создается битовая схема, а затем выполняется серия записей журнала. Эта структура позволяет Exchange Online выполнять ряд проверок (потерянный сброс, CRC и другие проверки) для проверки каждого файла журнала по мере его записи и повторного копирования. 

## <a name="deployment-on-resilient-file-system"></a>Развертывание в отказоустойчивых файловых системах 
Чтобы предотвратить повреждения на уровне файловой системы, Exchange Online развертывается в разделах файловой системы Resilient File System (ReFS) для улучшения возможностей восстановления. ReFS — это файловая система в Windows Server 2012 и более поздних версиях, которая обеспечивает более надувную устойчивость к повреждениям данных, обеспечивая тем самым максимальную доступность и целостность данных. В частности, ReFS обеспечивает усовершенствования способа обновления метаданных, что обеспечивает лучшую защиту данных и сокращает количество случаев повреждения данных. Кроме того, он использует контрольные контрольные объемы для проверки целостности данных и метаданных файлов, обеспечивая легкое и легкое найти и исправить повреждения данных. 

Exchange Online имеет ряд преимуществ ReFS: 
- Повышение устойчивости к целостности данных означает меньшее количество инцидентов повреждения данных. Уменьшение числа инцидентов повреждения означает меньшее количество ненужных повторного их повторного поиска. 
- Контрольная схема, запущенная для метаданных, позволяет быстрее и детерминировать обнаружение случаев повреждения, позволяя нам исправлять повреждения данных клиента до возникновения серых сбоев на томах данных.
- Хорошо работает с большими наборами данных ( петабайтами и большими) без влияния на производительность
- Поддержка других функций Exchange Online, таких как шифрование BitLocker. 

Exchange Online также дает преимущества от других функций ReFS: 
- **Целостность (потоки целостности)** — ReFS хранит данные таким образом, чтобы защитить их от многих распространенных ошибок, которые обычно могут привести к потере данных. Служба поиска Microsoft 365 использует потоки целостности для раннего обнаружения повреждения диска и контрольных объемов содержимого файла. Эта функция также позволяет уменьшить количество инцидентов повреждения, вызванных операцией записи в режиме "Некоркорновые записи" (когда операция записи не завершается из-за отключения питания и т. д.). 
- **Доступность (Salvage)** — ReFS приоритизирует доступность данных. В истории файловые системы часто подвержены повреждениям данных, из-за которых для восстановления системы требовалось от сети. Хотя в редких случаях, в случае повреждения, ReFS реализует функцию саvage, которая удаляет поврежденные данные из пространства имен в рабочем томе и гарантирует, что хорошие данные не будут отрицательно затронуты неустранимыми поврежденными данными. Применение функции salvage и изоляция повреждения данных к томам баз данных Exchange Online означает, что мы можем поддерживать не затронутые базы данных в поврежденном томе в период между временем повреждения и действиями по восстановлению. Такая структура повышает доступность баз данных, на которые обычно влияют такие проблемы повреждения диска. 
