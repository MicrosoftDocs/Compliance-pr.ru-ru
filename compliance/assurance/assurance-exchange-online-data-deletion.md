---
title: Удаление данных Microsoft 365 Exchange Online
description: Узнайте, как в Exchange Online обрабатываются мягкие и жесткие удаления данных для почтовых ящиков и элементов в почтовых ящиках.
ms.author: robmazz
author: robmazz
manager: laurawi
ms.reviewer: sosstah
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection:
- Strat_O365_IP
- M365-security-compliance
- MS-Compliance
f1.keywords:
- NOCSH
ms.custom: seo-marvel-apr2020
titleSuffix: Microsoft Service Assurance
ms.openlocfilehash: b86c855a113706731ac6037a2851ae0f1adaccb9
ms.sourcegitcommit: b06fa9f1b230fd5e470817486ea51f460f28b691
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/27/2021
ms.locfileid: "50012965"
---
# <a name="exchange-online-data-deletion-in-microsoft-365"></a>Удаление данных Exchange Online в Microsoft 365

В Exchange Online существует два типа удалений: мягкие и неутвердимые удаления. Это касается как почтовых ящиков, так и элементов в почтовом ящике.

## <a name="soft-deleted-and-hard-deleted-mailboxes"></a>Почтовые ящики, удаленные с неявным удалением и неутвердимые почтовые ящики

Удаленный почтовый ящик пользователя — это почтовый ящик, который был удален с помощью Центра администрирования Microsoft 365 или Remove-Mailbox и остается в корзине Azure Active Directory менее 30 дней. Почтовый ящик может быть легко удален любым из следующих способов:

- Учетная запись пользователя Azure Active Directory, связанная с почтовым ящиком пользователя, удаляется с возможностью удаления (объект пользователя выходит за рамки области действия или находится в контейнере корзины).
- Связанная с почтовым ящиком учетная запись пользователя Azure Active Directory не была удалена, но почтовый ящик Exchange Online находится на удержании для судебного разбирательства или удержании при обнаружении электронных данных.
- Учетная запись пользователя Azure Active Directory, связанная с почтовым ящиком пользователя, была стерта в течение последних 30 дней; Это максимальная продолжительность хранения, при которой Exchange Online будет хранить почтовый ящик в состоянии "мягкое удаление" до его окончательной удаления и невозмежности.

Удаленный почтовый ящик пользователя — это почтовый ящик, удаленный одним из следующих способов:

- Почтовый ящик пользователя был удален в течение более 30 дней, а связанный с ним пользователь Azure Active Directory был неустановим. Все содержимое почтового ящика, например сообщения электронной почты, контакты и файлы, удаляются окончательно.
- Учетная запись пользователя, связанная с почтовым ящиком пользователя, была удалена из Azure Active Directory. Теперь почтовый ящик пользователя удален в Exchange Online и остается в состоянии мягкого удаления в течение 30 дней. Если в течение 30 дней новый пользователь Azure Active Directory синхронизируется из исходной учетной записи получателя с тем же **ExchangeGuid** или **ArchiveGuid** и эта новая учетная запись лицензируется для Exchange Online, это приведет к неудамному удалюю исходного почтового ящика пользователя. Все содержимое почтового ящика, такое как сообщения электронной почты, контакты и файлы, окончательно удаляются.
- Удаленный почтовый ящик удаляется с помощью **remove-Mailbox -PermanentlyDelete.**

В вышеперечисленном сценарии удаления предполагается, что почтовый ящик пользователя не удерживается ни в одной из ситуаций, таких как удержание для судебного разбирательства или удержание при обнаружении электронных данных. Если для почтового ящика есть какой-либо тип удержания, его нельзя удалить. Для всех типов получателей [](https://support.office.com/article/manage-legal-investigations-in-office-365-2e5fbe9f-ee4d-4178-8ff8-4356bc1b168e?ui=en-US&rs=en-US&ad=US) почты любые параметры удержания игнорируются и не влияют на неутвердимые или мягкие удаления.

## <a name="soft-deleted-and-hard-deleted-items"></a>Элементы с неутвердимой и неутвердимой удалением

Когда пользователь удаляет элемент почтового ящика (например, сообщение электронной почты, контакт, встречу в календаре или задачу), элемент перемещается в папку "Элементы с возможностью восстановления" и во вложенную папку с именем "Deletions". Это называется "мягким удалением". Срок хранения удаленных элементов в папке Удаленные зависит от периода хранения удаленных элементов, настроенного для почтового ящика. По умолчанию почтовый ящик Exchange Online хранит удаленные элементы в течение 14 дней, но администраторы Exchange Online могут изменить этот параметр, чтобы увеличить период до 30 дней. (Дополнительные сведения об увеличении срока хранения удаленных элементов для почтового ящика Exchange Online см. в статье "Изменение срока хранения окончательно удаленных элементов для почтового ящика [Exchange Online".](https://docs.microsoft.com/exchange/recipients-in-exchange-online/manage-user-mailboxes/change-deleted-item-retention) Пользователи могут восстанавливать или удалять удаленные элементы до истечения срока хранения удаленного элемента. Для этого они используют функцию восстановления удаленных элементов в Microsoft Outlook или Outlook в Интернете.

Если пользователь удаляет удаленный элемент с помощью функции восстановления удаленных элементов в Outlook или Outlook в Интернете, это называется неоправданной очисткой. В Exchange Online восстановление одного элемента включено по умолчанию при создания нового [](https://docs.microsoft.com/Exchange/recipients/user-mailboxes/recover-deleted-messages) почтового ящика, поэтому администратор по-прежнему может восстанавливать удаленные элементы до истечения срока хранения удаленных элементов. Кроме того, если пользователь или процесс изменил сообщение, копии исходного элемента также сохраняются, если включено восстановление отдельного элемента.

## <a name="page-zeroing"></a>Обнуление страниц

*Обнуление* — это механизм безопасности, который записывает нули или двоичный шаблон над удаленными данными, чтобы восстановить удаленные данные было сложнее. В Exchange Online базы данных  почтовых ящиков используют страницы в качестве единицы хранения и реализуют процесс переописи под названием *обнуление страниц.* Обнуление страниц включено по умолчанию и не может быть отключено клиентами или корпорацией Майкрософт. Операции обнуля страниц записывают в файлы журнала транзакций, чтобы обнуление страниц для всех копий заданной базы данных было аналогичным образом. Обнуление страницы в активной копии базы данных приводит к обнулени страницы на пассивных копиях базы данных.

Обнуление страниц записывает двоичный шаблон на жестко удаленные записи. Шаблон обнуления страниц характерен для операций ESE (имя внутреннего якоря базы данных, используемого серверами в Exchange Online) и отличается для операций во время работы и фонового обслуживания базы данных. (Фоновое обслуживание базы данных — это процесс, который непрерывно проверяет и проверяет каждую базу данных. Его основная функция — контрольные страницы базы данных, но она также обрабатывает очистку пространства и обнуление записей и страниц, которые не были обнуляются из-за сбоя в Магазине.)

В следующей таблице перечислены шаблоны заполнения, соответствующие определенным операциям среды выполнения.

| Операция среды выполнения ESE   | Шаблон заполнения |
|--------------------------|--------------|
| Заменить                  | R            |
| Удалить запись или длинное значение | D            |
| Освобожденное место страницы         | H            |

В следующей таблице перечислены шаблоны заполнения, соответствующие определенным операциям, выполняемым во время фонового обслуживания базы данных ESE.

| Операция фонового обслуживания базы данных ESE | Шаблон заполнения |
|-----------------------------------------------|--------------|
| Удалить запись                                 | D            |
| Удалить длинное значение                             | L            |
| Освобожденное место частично используемой страницы       | Z            |
| Освобожденное место неиспользуемой страницы               | U            |

### <a name="page-zeroing-process"></a>Процесс обнуля страницы

Процесс обнуления страниц зависит от сценария удаления. В следующей таблице описаны сценарии удаления базы данных и случаи выполнения функций обнуления страниц.

| Сценарий удаления базы данных | Процесс ESE и временные рамки обнуления данных в базе данных |
|:--------------------------|:------------------------------------------------|
| Срок действия элемента истекает в зависимости от периода хранения удаленных элементов. | В асинхронном потоке двоичный шаблон записывается поверх удаленных данных. Это действие выполняется за те миллисекунды, в течение которых происходит удаление записи. Если происходит сбой процесса Store, пока не выполнена работа по асинхронному обнулении (или очистка хранения версий отменяется из-за роста банка версий), обнуление будет завершено, когда фоновое обслуживание базы данных обрабатывает этот раздел базы данных. |
| View Scenario: Expiration of items from Outlook/Outlook on the web folder view (for example, Conversation view) | Обнуление данных выполняется при обработке этого раздела базы данных во время фонового обслуживания базы данных. |
| Move Mailbox/Delete Mailbox Scenario: source mailbox deleted (expiry of deleted mailbox) | Обнуление данных выполняется при обработке этого раздела базы данных во время фонового обслуживания базы данных. |

### <a name="mailbox-data-types-without-page-zeroing"></a>Типы данных почтовых ящиков без обнуление страниц

Следующие типы данных почтовых ящиков не имеют условий для обнуля страниц:

- **Журналы** транзакций базы данных почтовых ящиков . При удалении журналов транзакций в рамках обычных операций не существует процесса обнуления блоков в файловой системе, в которой хранились удаленные файлы журналов. Скорее всего, файловая система быстро повторно встроит это свободное место для вновь созданных журналов, но нет гарантии, что это произойдет.
- **Файлы каталога индексов контента** — Exchange Online использует search Foundation (также известный как FAST) для функции индексации поиска. Каталог индексов поиска состоит из нескольких десятков файлов, хранимых в том же томе, что и файл базы данных почтовых ящиков. При необратимом удалении сообщения из базы данных почтовых ящиков связанное с ним содержимое в каталоге поиска не удаляется в тот же момент. Удаление контента происходит, когда Search Foundation делает теневое (или эталовое объединение) многих небольших файлов каталога в один файл большего размера. После завершения основного объединения файлы каталога меньшего размера удаляются. Обнулять блоки, в которые хранились удаленные файлы каталога, не требуется.

## <a name="continuous-replication"></a>Непрерывная репликация

Непрерывная репликация (также известная как доставка и воспроизведение журналов) — это технология в Exchange Online, которая создает и поддерживает копии каждой базы данных почтовых ящиков для обеспечения высокой доступности, устойчивости сайта и аварийного восстановления. Непрерывная репликация использует Exchange Server аварийного восстановления базы данных для предоставления технологии, которая выполняет асинхронное обновление одной или более копий базы данных почтовых ящиков. Каждый сервер почтовых ящиков записи обновлений базы данных, сделанных в активной базе данных (например, действия пользователя с электронной почтой), в качестве записей журнала в последовательном наборе файлов журнала транзакций объемом 1 МБ. Этот набор файлов называется потоком журнала. В непрерывной репликации поток журнала также используется для асинхронного обновления одной или более копий базы данных. Это достигается путем передачи журналов в расположение, содержащее пассивную копию активной базы данных, и их воспроизведения в пассивную копию базы данных. Если все журналы из активной базы данных реплицированы на пассивную копию базы данных, то две базы данных эквивалентны, и все физические изменения, сделанные в активной базе данных, реплицированы во все пассивные копии этой базы данных.

Любое удаление из базы данных почтовых ящиков, будь то элемент почтового ящика или весь почтовый ящик, а также возможность мягкого или неустойкого удаления представляет собой физическое изменение активной базы данных. Обнуление страниц также влечет за собой внесение физических изменений в активную базу данных. Эти изменения занося в файлы журналов в процессе, называемом непрерывной репликацией, и при воспроизведении этих файлов журнала в пассивных копиях базы данных в эти пассивные базы данных внося те же физические изменения.
